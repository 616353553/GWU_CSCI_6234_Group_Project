<html>
    <header>
        <h1>Pizza Order System</h1>
        <script src="scripts/requestlib.js", type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="css/style.css">
    </header>
    <body>
        <button id='cart-button' class="cart-button" onclick="window.location.href = 'cart.html'">Cart (0)</button>
        <div id="response"></div>
        <div id="response_1"></div>
        <h3>Signature Pizza</h3>
        <div id="menu-container"></div>
        <h3>Customize Your Own Pizza</h3>
        <div id="custom-pizza-container">
            <table>
                <tr>
                    <td><button onclick="window.location.href = 'pizzabuilder.html'">Build pizza</button></td>
                </tr>
            </table>
        </div>
        </table>
        <script>
            sendGetRequest('http://localhost:8080/home')
                .then(data => {
                    document.getElementById('response').innerHTML = JSON.stringify(data, null, 2)
                    return sendGetRequest(data['domain'] + data['menuUrl']);
                }).then(data => {
                    document.getElementById('response_1').innerHTML = JSON.stringify(data, null, 2)
                    let signaturePizza = data['signaturePizza'];
                    let menuTable = document.createElement("table");
                    let numRows = Math.ceil((signaturePizza.length) / 2);
                    for (let i = 0; i < numRows; i++) {
                        let row = menuTable.insertRow();
                        for (let j = 0; j < 2; j++) {
                            let index = 2 * i + j;
                            let cell = row.insertCell();
                            if (index < signaturePizza.length) {
                                let nameSpan = document.createElement('span');
                                nameSpan.textContent = signaturePizza[index]["name"];
                                cell.appendChild(nameSpan);
                                cell.appendChild(document.createElement('br'));

                                let priceSpan = document.createElement('span');
                                priceSpan.textContent = `$${signaturePizza[index]["retailPrice"]}`;
                                cell.appendChild(priceSpan);
                                cell.appendChild(document.createElement('br'));

                                let doughSpan = document.createElement('span');
                                doughSpan.textContent = `${signaturePizza[index]["doughSizeName"]} ${signaturePizza[index]["doughName"]}`;
                                cell.appendChild(doughSpan);
                                cell.appendChild(document.createElement('br'));

                                let cheeseSpan = document.createElement('span');
                                if (signaturePizza[index]["cheeseLevelName1"] != signaturePizza[index]["cheeseLevelName2"] 
                                    || signaturePizza[index]["cheeseName1"] != signaturePizza[index]["cheeseName2"]) {
                                    cheeseSpan.textContent = `${signaturePizza[index]["cheeseLevelName1"]} ${signaturePizza[index]["cheeseName1"]} & ${signaturePizza[index]["cheeseLevelName2"]} ${signaturePizza[index]["cheeseName2"]}`;
                                } else {
                                    cheeseSpan.textContent = `${signaturePizza[index]["cheeseLevelName1"]} ${signaturePizza[index]["cheeseName1"]}`;
                                }
                                cell.appendChild(cheeseSpan);
                                cell.appendChild(document.createElement('br'));

                                let sauceSpan = document.createElement('span');
                                sauceSpan.textContent = `${signaturePizza[index]["sauceIntensityName"]} ${signaturePizza[index]["sauceName"]}`;
                                cell.appendChild(sauceSpan);
                                cell.appendChild(document.createElement('br'));

                                let toppingArr = [];
                                if (signaturePizza[index]["toppingName1"] != "None") {
                                    toppingArr.push(signaturePizza[index]["toppingName1"]);
                                }
                                if (signaturePizza[index]["toppingName2"] != "None") {
                                    toppingArr.push(signaturePizza[index]["toppingName2"]);
                                }
                                if (signaturePizza[index]["toppingName3"] != "None") {
                                    toppingArr.push(signaturePizza[index]["toppingName3"]);
                                }
                                console.log(toppingArr.length);
                                let toppingSpan = document.createElement('span');
                                toppingSpan.textContent = toppingArr.join(" & ");
                                cell.appendChild(toppingSpan);
                                cell.appendChild(document.createElement('br'));
                            }
                        }
                    }
                    document.getElementById('menu-container').appendChild(menuTable);
                    sessionStorage.setItem('pizzaBuilderOptionUrl', data['domina'] + data['customPizza']['pizzaBuilderOptionUrl']);
                }).catch(error => {
                    console.error('Error occurred:', error);
                });
        </script>
    </body>
    <footer>
    </footer>
</html>